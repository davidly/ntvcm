# ntvcm
NT Virtual CP/M Machine. Emulates CP/M 2.2 and the 8080/Z80 on Windows to run .com files. 

This app emulates the subset of CP/M 2.2 required to run asm.com, load.com, and Turbo Pascal
versions 1.00 and 3.01A. The latter two use bdos APIs very differently.

Console input/output work for both bios bdos API. Disk input/output work via the bdos API.
There is no attempt at emulating physical disks; apps that use bdos will just work.

The x80 emulator passes at 100% for:
    
    8080: 8080ex1.com, 8080pre.com, Microcosm v1.0, and cputest.com V1.2 in 8080 mode.
    
    Z80: zexall.com, zexdoc.com, and cputest.com V1.2 in Z80 mode.
    
I implemented this to automate testing of apps generated by the BA BASIC compiler in my TTT repo,
so I wouldn't have to copy files to my TRS-80 Model 100 or Z80 CP/M 2.2 machines. It was just
as painful copying them to other emulators because those (that I found) can't be invoked with 
other Windows apps in a test script.

The app supports tracing to the ntvcm.log file. Instruction tracing includes a disassembler
that shows instructions either as 8080 or Z80 depending on the mode.

Performance of the CPU emulator is faster than the half-dozen other emulators I looked at. I
wrote the code to be more readable than other emulators, whose use of lookup tables and macros
I found to be nearly inscrutable. An interesting fact is that on modern CPUs, code for computing
parity of a byte is faster than a 256-element lookup table. The same applies for other tables.

    NT Virtual CP/M 2.2 Machine: emulates a CP/M 2.2 i8080/Z80 runtime environment

    usage: ntvcm [-c] [-p] [-s:X] [-t] <cp/m 2.2 .com file> [filearg1] [filearg2]

    notes:    filearg1 and filearg2 optionally specify filename arguments for the command
              -c     don't auto-detect ESC characters and change to to 80x24 mode
              -i     trace 8080/Z80 instructions when tracing
              -p     show performance information
              -s:X   speed in Hz. Default is 0, which is as fast as possible.
                     for 4Mhz, use -s:4000000
              -t     enable debug tracing to ntvcm.log
              -8     emulate 8080, not Z80
              e.g. to assemble, load, and run test.asm:
                   ntvcm asm.com test
                   ntvcm load.com test
                   ntvcm test.com
